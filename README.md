## Микросервисы

#### **Gateway Server** (8080)
- Единая точка входа для всех запросов
- Маршрутизация и балансировка нагрузки


#### **Discovery Server** (8761) 
- Service discovery и регистрация сервисов
- Health checks и мониторинг

#### **Config Server** (8888)
- Централизованное управление конфигурацией

#### **Бизнес-сервисы**

| Сервис | База данных | Описание |
|--------|------|----------|
| **Event Service** | events-db | Управление событиями, категориями, подборками |
| **User Service** | users-db | Управление пользователями и ролями |
| **Location Service** | locations-db | Управление локациями и геопоиск |
| **Request Service** | requests-db | Запросы на участие в событиях |

#### **Stats Service**
- Сбор и хранение статистики просмотров
- Аналитика популярности событий

### API Endpoints для внутреннего использования

**Event Service**

`GET /api/events/{eventId}?userId={optional}` - данные события

`GET /api/events/check-exists/{locationId}` - проверка существования события по id локации

**Location Service**

`POST /api/locations/get-or-create` - найти локацию или создать новую

`GET /api/locations/{id}` - данные локации

`POST /api/locations` - данные нескольких локаций

**User Service**

`GET /api/users/{id}` - данные пользователя

`POST /api/users` - данные нескольких пользователей

`GET /api/users/check-exists/{id}` - проверка существования

**Request Service**

`POST /api/requests/counts` - кол-во заявок по событиям



## Запуск

```bash
# Сборка и запуск всех сервисов
docker compose up --build
```

## Дополнительная функциональность - "Управление локациями"

### Структура локации

**Поля**

- `id` -	Уникальный идентификатор локации (целое число)
- `creator`	- Пользователь, создавший локацию
- `name` -	Название локации, строка
- `address` -	Физический адрес локации (опционально), строка
- `latitude`	- Широта (обязательное поле, диапазон: [-90, 90])
- `longitude`	- Долгота (обязательное поле, диапазон: [-180, 180])
- `state`	- Статус локации (`PENDING`, `APPROVED`, `REJECTED`, `AUTO_GENERATED`). По умолчанию — `PENDING`.

**Статусы локаций**

`PENDING` - этот статус получают локации, созданные пользователями, до момента одобрения локации администратором. Локации с этим статусом нельзя привязывать к событиям и они не видны другим пользователям при поиске.

`APPROVED` - этот статус получают локации, созданные или одобренные администратором. Локации с этим статусом можно привязывать к событиям и видны другим пользователям при поиске.

`REJECTED` - локации, отклоненные администратором. Локации с этим статусом нельзя привязывать к событиям и они не видны другим пользователям при поиске.

`AUTO_GENERATED` - "безымынные" локации, не имеющие создателя, имени и адреса, а только координаты.

Статус локации может менять только администратор.
Администратор не может переводить локацию из любого статуса в `PENDING` или `AUTO_GENERATED`.

### Создание локации

##### Создание администратором.
Созданная локация автоматически получает статус `APPROVED` и поле creator является `null`.

##### Создание пользователем.
При получении запроса на создание локации система проверяет наличие существующей локации с тем же именем в тех же координатах (в радиусе 50 м). В случае нахождения - возвращается ошибка с кодом `409` и `id` существующей локации.

Созданная локация получает статус `PENDING`.

##### Автоматическое создание локации
При создании события с указанием координат, но без указания `id` локации система ищет существующую `AUTO_GENERATED` локацию в данных координатах (в радиусе 20 метров):
- если находит - привязывает найденную локацию к событию
- если нет - создает новую `AUTO_GENERATED` локацию с данными координатами и привязывает ее.

**Почему приложение ищет только среди `AUTO_GENERATED` локаций, без `APPROVED`?** Чтобы избежать автоматической привязки локации, которая географически находится в том же месте, но не имеет отношения к данному событию (например студия йоги и кружок детского творчества могут находиться в одном здании).


### Редактирование локации

##### Редактирование администратором

Администратор может редактировать все поля (включая статус) всех локаций.

##### Редактирование пользователем

Пользователь может редактировать данные только своих локаций, которые в статусе `PENDING`.

### Поиск и просмотр локаций

**Администратору доступен поиск среди всех локаций с фильтрацией по:**

- совпадению в тексте названия или адреса
- id создателя (для поиска локаций без информации о создателе следует вводить в запрос `creatorId=0`)
- статусу
- координатам (с указанием радиуса поиска)

**Пользователю доступен поиск среди своих локаций с фильтрацией по:**

- статусу
- совпадению в тексте названия или адреса
- координатам (с указанием радиуса поиска)

**Публичный поиск среди одобренных локаций с фильтрацией по:**

- совпадению в тексте названия или адреса
- координатам (с указанием радиуса поиска)

Публичный поиск локаций позволит пользователю найти существующую локацию для дальнейшего создания события с привязкой к ней.

Администратор видит все поля всех локаций.
Пользователи не видят создателя локации.

### Поиск событий по локациям или координатам (с радиусом)

Публичный поиск мероприятий позволяет находить события по `id` локации

### Удаление локаций

Удалять локации может администратор либо создатель.

Нельзя удалять локации, к которым привязаны события.
